doctype html
html
  head
    title= pageTitle
    meta(name="description", content="Dynamic webview")
    link(id="favicon", rel="icon", href="https://glitch.com/edit/favicon-app.ico", type="image/x-icon")
    meta(charset="utf-8")
    meta(http-equiv="X-UA-Compatible", content="IE=edge")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    
  body
    script.
        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'Messenger'));
        
    main
      img(src="https://lochnan.files.wordpress.com/2015/07/conejo.png", title="High five")
      
    h2 Selecciona tus productos
    
    form(id="preferencesForm")


      input(type="checkbox" id="likes-bots" name="var1" value="yes" onchange='sumarProductos()')
      label(for="likes-bots") Producto1

      input(type="checkbox" id="likes-bots" name="var2" value="yes" onchange='sumarProductos()')
      label(for="likes-bots") Producto2

      input(type="checkbox" id="likes-bots" name="var3" value="yes" onchange='sumarProductos()')
      label(for="likes-bots") Producto3

      br
      br

      p(name="text") S/.

      p(name="precio") 0


      br
      br

      input(type="input" id="likes-bots" name="comentario" value="-")
      label(for="likes-bots") Comentario

      br
      br

      input(type="input" id="likes-bots" name="cupon" value="-")
      label(for="likes-bots") Cupon de descuento

      br 
      br
      
      input(type="hidden", name="userId" value=userId)
      input(type="hidden", name="blockName", value=blockName)

      button(type="submit") Ordenar




      script.
  function sumarProductos() {

  document.getElementsByName("precio")[0].innerHTML = 20;
  }


    script(src="https://code.jquery.com/jquery-2.2.1.min.js",
            integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00=",
            crossorigin="anonymous")

    script.
        // This function is called when the extensions are loaded and ready
        window.extAsyncInit = function() {
            console.log('MessengerExtensions are ready');

            // Handle button click
            $('#preferencesForm').submit(function(event) {
                console.log('Pressed submit button');
                event.preventDefault();

                // Get the form data to send to our endpoint
                const formData = $('#preferencesForm').serialize();

                // Post to our server endpoint to broadcast back to the user
                $.post('/dynamic-webview-new', formData, (data) => {
                    MessengerExtensions.requestCloseBrowser(function success() {
                        // webview closed
                        console.log('Closed the window!');
                    }, function error(error) {
                        // an error occurred
                        console.log('Error closing browser window!');
                        console.log(error);
                        $('#infoMessage').text(`requestCloseBrowser error : ${error}`);
                    });
                });
            });
        };





    
